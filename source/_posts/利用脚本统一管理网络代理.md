---
title: 利用脚本统一管理网络代理
date: 2019-06-01 22:16:14
tags:
- 运维
- MAC系统
- 脚本
---
# 通过shell脚本改变代理

## 背景

mac系统下，用ssr能够自动设置socks的代理，但是发现google云盘等应用必须要设置https或者http代理才能够使用。

每次进行手动在```系统便好设置->网络->高级->代理```设置ssr等代理地址比较繁琐，并且网络环境一发生改变就需要重新设置。

## Shell脚本编写

### 列出网络环境


    >>>networksetup -listallnetworkservices

    USB 10/100/1000 LAN
    Wi-Fi
    Bluetooth PAN
    Thunderbolt Bridge


显示当前使用的是4种，其中常用的为usb和wifi两种

### 通过命令控制代理

    sudo networksetup -setwebproxy "Wi-Fi" 127.0.0.1 12333

__Wi-Fi为网络类型名称，127.0.0.1为代理ip，12333为代理端口 (代理ip和端口可以从ssr"_复制http代理设置_"中获取)__

通过图形窗口发现代码生效

### Shell实现自动化

由于sudo每次都要输入密码，可以使用：

    echo "password" |sudo networksetup -setwebproxy "Wi-Fi" 127.0.0.1 12333

将前面输出的信息，给后面的代码

于是有了下面的代码：


    !/bin/bash

    echo "🤓 Hello Boy! \nI have changed the PROXY for you"

    proxy_http_on(){
        echo "password" | sudo -S networksetup -setwebproxy "Wi-Fi" 127.0.0.1 12333
    }

    proxy_https_on(){
        echo "password" | sudo -S networksetup -setsecurewebproxy "Wi-Fi" 127.0.0.1 12333
    }

    proxy_all_on(){
        echo "password" | sudo -S networksetup -setwebproxy "Wi-Fi" 127.0.0.1 12333 && sudo -S networksetup -setsecurewebproxy "Wi-Fi" 127.0.0.1 12333
    }

    proxy_http_off(){
        echo "password" | sudo -S networksetup -setwebproxystate "Wi-Fi" off
    }

    proxy_https_off(){
        echo "password" | sudo -S networksetup -setsecurewebproxystate "Wi-Fi" off
    }

    proxy_all_off(){
        echo "password" | sudo -S networksetup -setwebproxystate "Wi-Fi" off && sudo -S networksetup -setsecurewebproxystate "Wi-Fi" off
    }

    proxy_lan_on(){
        echo "password" | sudo -S networksetup -setwebproxy "USB 10/100/1000 LAN" 127.0.0.1 12333 && sudo -S networksetup -setsecurewebproxy "USB 10/100/1000 LAN" 127.0.0.1 12333
    }

    proxy_lan_off(){
        echo "password" | sudo -S networksetup -setwebproxystate "USB 10/100/1000 LAN" off && sudo -S networksetup -setsecurewebproxystate "USB 10/100/1000 LAN" off
    }

    if [ "$1" = "httpon" ];then
        proxy_http_on
    elif [ "$1" = "httpson" ];then
        proxy_https_on
    elif [ "$1" = "allon" ];then
        proxy_all_on
    elif [ "$1" = "httpoff" ];then
        proxy_http_off
    elif [ "$1" = "httpsoff" ];then
        proxy_https_off
    elif [ "$1" = "alloff" ];then
        proxy_all_off
    elif [ "$1" = "lanon" ];then
        proxy_lan_on
    elif [ "$1" = "lanoff" ];then
        proxy_lan_off
    else
        printf "Usage: sh fileName.sh {httpon | httpson | allon | httpoff | httpsoff | alloff | lanon | lanoff}\n"
    fi


## 更加便捷

使用.bash_profile文件设置一个别名可以更加方便的使用，为了便捷只设置了`proxy_all_on/off`和`proxy_lan_on/off`：


    alias wifipon="sudo sh ~/Documents/Configs/proxyChange.sh allon"
    alias wifipoff="sudo sh ~/Documents/Configs/proxyChange.sh alloff"
    alias lanpon="sudo sh ~/Documents/Configs/proxyChange.sh lanon"
    alias lanpoff="sudo sh ~/Documents/Configs/proxyChange.sh lanoff"


