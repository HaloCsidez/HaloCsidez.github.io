---
title: 面试中Kafka的问题
date: 2020-04-01 22:16:14
tags:
- Kafka
- 集群
- SpringCloud

---

## Kafka

### 简介

分布式流处理平台

- 流平台的三个关键功能：

      1. 消息队列：发布和订阅消息流，这个功能类似于消息队列，这也是 Kafka 也被归类为消息队列的原因；
      2. 容错的持久方式存储记录消息流： Kafka 会把消息持久化到磁盘，有效避免了消息丢失的风险；
      3. 流式处理平台： 在消息发布的时候进行处理，Kafka 提供了一个完整的流式处理类库。

- 应用场景：

      1. 消息队列： 建立实时流数据管道，在系统或者应用程序之间获取数据；
      2. 数据处理： 构建实时的流处理程序来转换或处理数据流

- 关键词

      1. Producer 产生消息的一方。
      2. Consumer
      3. Broker
      4. Topic
      5. Partition

### 易产生的问题

消费端重复消费：很容易解决，建立去重表

消费端丢失数据：也容易解决，关闭自动提交offset，处理完之后受到移位

生产端重复发送：这个不重要，消费端消费之前从去重表中判重就可以

生产端丢失数据：这个是最麻烦的情况

- 解决策略：

1.异步方式缓冲区满了，就阻塞在那，等着缓冲区可用，不能清空缓冲区

2.发送消息之后回调函数，发送成功就发送下一条，发送失败就记在日志中，等着定时脚本来扫描

（发送失败可能并不真的发送失败，只是没收到反馈，定时脚本可能会重发）



- 如何保证有序：

如果有一个发送失败了，后面的就不能继续发了，不然重发的那个肯定乱序了

生产者在收到发送成功的反馈之前，不能发下一条数据，但我感觉生产者是一个流，阻塞生产者感觉业务上不可行，怎么会因为一条消息发出去没收到反馈，就阻塞生产者



同步发送模式：发出消息后，必须阻塞等待收到通知后，才发送下一条消息

异步发送模式：一直往缓冲区写，然后一把写到队列中去

两种都是各有利弊：

同步发送模式虽然吞吐量小，但是发一条收到确认后再发下一条，既能保证不丢失消息，又能保证顺序


Java使用Apache.Kafka的jar包